---
- name: "Setup DNS"
  hosts: 127.0.0.1
  connection: local
  vars_files:
    - vars/cloudflare.yml
  tasks:
    - import_tasks: dns.yml
  tags:
    - install-base
    - update-config
  
- name: "Install requirements on all hosts"
  hosts: all
  become: yes

  # Assume we're doing a completely new install from a fresh server
  # Fact gathering requires python, which the server may not have
  gather_facts: no
  
  roles:
    - ansible-requirements  # Installs python2.7, 3
    - ubuntu-universe       # Add's ubuntu universe source (which has python-pip, etc..)
    - essential-utils
    - docker
    - apt-autoremove        # Remove unused deps if they changed after updates
  tags:
    - install-base
    - update-packages

- name: "Configure all hosts"
  hosts: all
  become: yes
  gather_facts: yes

  roles:
    - netsoc-neo-dir      # Copies over config changes

  tags:
    - install-base
    - update-config
