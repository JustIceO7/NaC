---

- name: "Add DNS records for each server name"
  cloudflare_dns:
    zone: "netsoc.dev"
    type: A
    record: "{{ item }}.netsoc.dev"
    value: "{{ hostvars[item].ansible_host }}" # ansible_host in hosts.yml
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"
  with_inventory_hostnames:
    - all

# Root domain
- name: "CNAME netsoc.dev = bigbertha.netsoc.dev"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: CNAME
    record: "netsoc.dev"
    value: "bigbertha.netsoc.dev"
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"

# The wildcard
- name: "CNAME *.netsoc.dev = bigbertha.netsoc.dev"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: CNAME
    record: "*.netsoc.dev"
    value: "bigbertha.netsoc.dev"
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"

# FreeIPA actual
- name: "A ipa.netsoc.dev = bertha IP"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: A
    record: "ipa.netsoc.dev"
    value: "{{ hostvars['bigbertha'].ansible_host }}"
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"

