---

- name: "Add DNS records for each server name"
  cloudflare_dns:
    zone: "netsoc.dev"
    type: A
    record: "{{ item }}.netsoc.dev"
    value: "{{ hostvars[item].ansible_host }}" # ansible_host in hosts.yml
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"
  with_inventory_hostnames:
    - all

# Root domain
- name: "CNAME netsoc.dev = feynman.netsoc.dev"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: CNAME
    record: "netsoc.dev"
    value: "feynman.netsoc.dev"
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"

# The wildcard
- name: "CNAME *.netsoc.dev = feynman.netsoc.dev"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: CNAME
    record: "*.netsoc.dev"
    value: "feynman.netsoc.dev"
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"

# FreeIPA POC
- name: "A feyn-ipa.netsoc.dev = feynman IP"
  cloudflare_dns:
    zone:  "netsoc.dev"
    type: A
    record: "feyn-ipa.netsoc.dev"
    value: "{{ hostvars['feynman'].ansible_host }}" # feynman IP
    state: present
    account_email: "{{ cf_api_email }}"
    account_api_token: "{{ cf_api_key }}"
